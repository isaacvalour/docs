---
title: "Enable 2FA"
api: "POST /v1/2fa/enable"
description: "Enable two-factor authentication with verification code"
---

## Overview

Enable two-factor authentication (2FA) for the authenticated user by verifying a code from their authenticator app. This endpoint completes the 2FA setup process.

<Note>
  This endpoint requires authentication via Bearer token in the Authorization header.
</Note>

## Request

<ParamField header="Authorization" type="string" required>
  Bearer token for authentication. Format: `Bearer <access_token>`
</ParamField>

<ParamField body="code" type="string" required>
  Six-digit verification code from the authenticator app.
</ParamField>

## Response

<ResponseField name="success" type="boolean">
  Indicates if 2FA was enabled successfully.
</ResponseField>

<ResponseField name="message" type="string">
  Success message.
</ResponseField>

<ResponseField name="data" type="object">
  Enable 2FA data object.
</ResponseField>

<ResponseField name="data.enabled" type="boolean">
  Whether 2FA is now enabled.
</ResponseField>

<ResponseField name="data.enabled_at" type="string">
  Timestamp when 2FA was enabled.
</ResponseField>

<ResponseField name="data.backup_codes" type="array">
  List of backup codes for account recovery.
</ResponseField>

<ResponseField name="data.backup_codes[].code" type="string">
  Individual backup code.
</ResponseField>

<ResponseField name="data.backup_codes[].used" type="boolean">
  Whether the backup code has been used.
</ResponseField>

## Example Request

<CodeGroup>

```bash cURL
curl -X POST "https://api.railsfromthecrypt.com/v1/2fa/enable" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "code": "123456"
  }'
```

```javascript JavaScript
const response = await fetch('https://api.railsfromthecrypt.com/v1/2fa/enable', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer YOUR_ACCESS_TOKEN',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    code: '123456'
  })
});

const data = await response.json();
console.log(data);
```

```python Python
import requests

response = requests.post(
    'https://api.railsfromthecrypt.com/v1/2fa/enable',
    headers={
        'Authorization': 'Bearer YOUR_ACCESS_TOKEN',
        'Content-Type': 'application/json'
    },
    json={
        'code': '123456'
    }
)

data = response.json()
print(data)
```

</CodeGroup>

## Example Response

<ResponseExample>

```json Success Response
{
  "success": true,
  "message": "2FA enabled successfully",
  "data": {
    "enabled": true,
    "enabled_at": "2024-01-01T12:00:00Z",
    "backup_codes": [
      {
        "code": "ABCD-EFGH-IJKL",
        "used": false
      },
      {
        "code": "MNOP-QRST-UVWX",
        "used": false
      },
      {
        "code": "YZAB-CDEF-GHIJ",
        "used": false
      },
      {
        "code": "KLMN-OPQR-STUV",
        "used": false
      },
      {
        "code": "WXYZ-ABCD-EFGH",
        "used": false
      }
    ]
  }
}
```

</ResponseExample>

## Error Responses

<ResponseExample>

```json Invalid Code
{
  "success": false,
  "message": "Invalid verification code",
  "error": {
    "code": "INVALID_2FA_CODE",
    "type": "authentication_error",
    "details": "The verification code is invalid or expired"
  }
}
```

```json 2FA Already Enabled
{
  "success": false,
  "message": "2FA already enabled",
  "error": {
    "code": "2FA_ALREADY_ENABLED",
    "type": "validation_error",
    "details": "Two-factor authentication is already enabled for this account"
  }
}
```

```json Unauthorized
{
  "success": false,
  "message": "Unauthorized",
  "error": {
    "code": "UNAUTHORIZED",
    "type": "authentication_error",
    "details": "Invalid or expired token"
  }
}
```

</ResponseExample>

## Status Codes

<ResponseField name="200" type="number">
  2FA enabled successfully
</ResponseField>

<ResponseField name="400" type="number">
  Bad request - invalid code format
</ResponseField>

<ResponseField name="401" type="number">
  Unauthorized - invalid or expired token
</ResponseField>

<ResponseField name="409" type="number">
  Conflict - 2FA already enabled
</ResponseField>

<ResponseField name="500" type="number">
  Internal server error
</ResponseField>

## Implementation Example

<CodeGroup>

```javascript JavaScript
class TwoFactorEnabler {
  constructor(apiClient) {
    this.apiClient = apiClient;
  }
  
  async enable2FA(code) {
    try {
      const response = await this.apiClient.post('/v1/2fa/enable', {
        code: code
      });
      
      if (response.success) {
        this.handleSuccess(response.data);
        return response.data;
      } else {
        throw new Error(response.message);
      }
    } catch (error) {
      this.handleError(error);
      throw error;
    }
  }
  
  handleSuccess(data) {
    // Show success message
    this.showSuccessMessage('2FA enabled successfully!');
    
    // Display backup codes
    this.displayBackupCodes(data.backup_codes);
    
    // Update UI to show 2FA is enabled
    this.updateUIForEnabled2FA();
    
    // Redirect to dashboard or next step
    setTimeout(() => {
      window.location.href = '/dashboard';
    }, 3000);
  }
  
  displayBackupCodes(backupCodes) {
    const backupCodesContainer = document.getElementById('backup-codes');
    backupCodesContainer.innerHTML = `
      <h3>Backup Codes</h3>
      <p>Save these backup codes in a safe place. You can use them to access your account if you lose your authenticator device.</p>
      <div class="backup-codes-list">
        ${backupCodes.map(code => `
          <div class="backup-code">
            <code>${code.code}</code>
            <span class="status ${code.used ? 'used' : 'available'}">
              ${code.used ? 'Used' : 'Available'}
            </span>
          </div>
        `).join('')}
      </div>
      <button onclick="this.parentElement.style.display='none'">I've saved these codes</button>
    `;
    backupCodesContainer.style.display = 'block';
  }
  
  updateUIForEnabled2FA() {
    // Update status indicator
    const statusIndicator = document.getElementById('2fa-status');
    statusIndicator.textContent = 'Enabled';
    statusIndicator.className = 'status enabled';
    
    // Hide setup form
    const setupForm = document.getElementById('2fa-setup-form');
    setupForm.style.display = 'none';
    
    // Show management options
    const managementOptions = document.getElementById('2fa-management');
    managementOptions.style.display = 'block';
  }
  
  handleError(error) {
    let errorMessage = 'Failed to enable 2FA';
    
    if (error.message.includes('Invalid verification code')) {
      errorMessage = 'Invalid verification code. Please check your authenticator app and try again.';
    } else if (error.message.includes('already enabled')) {
      errorMessage = '2FA is already enabled for this account.';
    }
    
    this.showErrorMessage(errorMessage);
  }
  
  showSuccessMessage(message) {
    const alert = document.createElement('div');
    alert.className = 'alert alert-success';
    alert.textContent = message;
    document.body.appendChild(alert);
    
    setTimeout(() => {
      alert.remove();
    }, 5000);
  }
  
  showErrorMessage(message) {
    const alert = document.createElement('div');
    alert.className = 'alert alert-error';
    alert.textContent = message;
    document.body.appendChild(alert);
    
    setTimeout(() => {
      alert.remove();
    }, 5000);
  }
  
  validateCode(code) {
    // Check if code is 6 digits
    return /^\d{6}$/.test(code);
  }
}

// Usage
const twoFactorEnabler = new TwoFactorEnabler(apiClient);

// Handle form submission
document.getElementById('enable-2fa-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const code = document.getElementById('verification-code').value;
  
  if (twoFactorEnabler.validateCode(code)) {
    try {
      await twoFactorEnabler.enable2FA(code);
    } catch (error) {
      console.error('Failed to enable 2FA:', error);
    }
  } else {
    alert('Please enter a valid 6-digit code');
  }
});
```

</CodeGroup>

## Backup Codes

Backup codes are provided when 2FA is enabled and can be used to access your account if you lose your authenticator device:

### Important Notes

- **Save backup codes securely** - Store them in a safe place
- **One-time use** - Each backup code can only be used once
- **Limited quantity** - You receive a limited number of backup codes
- **Regenerate if needed** - Contact support to regenerate backup codes

### Using Backup Codes

When logging in with 2FA enabled, you can use a backup code instead of your authenticator app:

1. Enter your email and password
2. When prompted for 2FA code, click "Use backup code"
3. Enter one of your backup codes
4. The backup code will be marked as used

## Security Best Practices

<AccordionGroup>
  <Accordion title="Code Validation">
    - Verify codes are 6 digits
    - Check code format before submission
    - Implement rate limiting for failed attempts
    - Use secure random number generation
  </Accordion>
  <Accordion title="Backup Code Security">
    - Generate cryptographically secure backup codes
    - Store backup codes securely
    - Implement proper backup code validation
    - Track backup code usage
  </Accordion>
  <Accordion title="User Experience">
    - Provide clear error messages
    - Show backup codes prominently
    - Offer code regeneration options
    - Implement proper session management
  </Accordion>
</AccordionGroup>

## Related Endpoints

<CardGroup cols={2}>
  <Card
    title="Get 2FA QR Code"
    icon="qrcode"
    href="/api/2fa/qrcode"
  >
    Get QR code for 2FA setup
  </Card>
  <Card
    title="Verify 2FA"
    icon="check-circle"
    href="/api/auth/verify-2fa"
  >
    Verify 2FA code during login
  </Card>
  <Card
    title="Authentication Guide"
    icon="book"
    href="/authentication"
  >
    Complete authentication guide
  </Card>
  <Card
    title="Support"
    icon="headset"
    href="mailto:support@hashrails.xyz"
  >
    Get help with 2FA setup
  </Card>
</CardGroup>
