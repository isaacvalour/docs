---
title: "Link Onboarding"
api: "POST /v1/onboard/link"
description: "Link onboarding session to user account"
---

## Overview

Link an existing onboarding session to a user account. This endpoint is used to associate an onboarding session with a user after they have completed registration or login.

<Note>
  This endpoint requires authentication via Bearer token in the Authorization header.
</Note>

## Request

<ParamField header="Authorization" type="string" required>
  Bearer token for authentication. Format: `Bearer <access_token>`
</ParamField>

<ParamField body="onboarding_token" type="string" required>
  Onboarding session token to link.
</ParamField>

<ParamField body="user_id" type="string">
  User ID to link the onboarding session to. If not provided, uses the authenticated user.
</ParamField>

<ParamField body="metadata" type="object">
  Additional metadata for the linking process.
</ParamField>

<ParamField body="metadata.source" type="string">
  Source of the linking (e.g., "web", "mobile", "api").
</ParamField>

<ParamField body="metadata.referral_code" type="string">
  Referral code if applicable.
</ParamField>

## Response

<ResponseField name="success" type="boolean">
  Indicates if the onboarding session was linked successfully.
</ResponseField>

<ResponseField name="message" type="string">
  Success message.
</ResponseField>

<ResponseField name="data" type="object">
  Linked onboarding session data.
</ResponseField>

<ResponseField name="data.id" type="string">
  Onboarding session identifier.
</ResponseField>

<ResponseField name="data.user_id" type="string">
  User ID the session is linked to.
</ResponseField>

<ResponseField name="data.type" type="string">
  Type of onboarding session.
</ResponseField>

<ResponseField name="data.status" type="string">
  Current status of the onboarding session.
</ResponseField>

<ResponseField name="data.current_step" type="string">
  Current step in the onboarding process.
</ResponseField>

<ResponseField name="data.token" type="string">
  Onboarding token.
</ResponseField>

<ResponseField name="data.steps" type="array">
  List of steps in the onboarding process.
</ResponseField>

<ResponseField name="data.steps[].id" type="string">
  Step identifier.
</ResponseField>

<ResponseField name="data.steps[].name" type="string">
  Step name.
</ResponseField>

<ResponseField name="data.steps[].description" type="string">
  Step description.
</ResponseField>

<ResponseField name="data.steps[].status" type="string">
  Step status: "pending", "in_progress", "completed", "skipped".
</ResponseField>

<ResponseField name="data.steps[].required" type="boolean">
  Whether the step is required.
</ResponseField>

<ResponseField name="data.steps[].order" type="number">
  Step order in the process.
</ResponseField>

<ResponseField name="data.progress" type="object">
  Onboarding progress information.
</ResponseField>

<ResponseField name="data.progress.completed_steps" type="number">
  Number of completed steps.
</ResponseField>

<ResponseField name="data.progress.total_steps" type="number">
  Total number of steps.
</ResponseField>

<ResponseField name="data.progress.percentage" type="number">
  Completion percentage.
</ResponseField>

<ResponseField name="data.linked_at" type="string">
  Timestamp when the session was linked.
</ResponseField>

<ResponseField name="data.created_at" type="string">
  Onboarding session creation timestamp.
</ResponseField>

<ResponseField name="data.updated_at" type="string">
  Last update timestamp.
</ResponseField>

## Example Request

<CodeGroup>

```bash cURL
curl -X POST "https://api.railsfromthecrypt.com/v1/onboard/link" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "onboarding_token": "onboard_token_abc123def456",
    "metadata": {
      "source": "web",
      "referral_code": "FRIEND123"
    }
  }'
```

```javascript JavaScript
const response = await fetch('https://api.railsfromthecrypt.com/v1/onboard/link', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer YOUR_ACCESS_TOKEN',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    onboarding_token: 'onboard_token_abc123def456',
    metadata: {
      source: 'web',
      referral_code: 'FRIEND123'
    }
  })
});

const data = await response.json();
console.log(data);
```

```python Python
import requests

response = requests.post(
    'https://api.railsfromthecrypt.com/v1/onboard/link',
    headers={
        'Authorization': 'Bearer YOUR_ACCESS_TOKEN',
        'Content-Type': 'application/json'
    },
    json={
        'onboarding_token': 'onboard_token_abc123def456',
        'metadata': {
            'source': 'web',
            'referral_code': 'FRIEND123'
        }
    }
)

data = response.json()
print(data)
```

</CodeGroup>

## Example Response

<ResponseExample>

```json Success Response
{
  "success": true,
  "message": "Onboarding session linked successfully",
  "data": {
    "id": "onboard_1234567890",
    "user_id": "user_1234567890",
    "type": "individual",
    "status": "in_progress",
    "current_step": "profile",
    "token": "onboard_token_abc123def456",
    "steps": [
      {
        "id": "welcome",
        "name": "Welcome",
        "description": "Introduction to the platform",
        "status": "completed",
        "required": true,
        "order": 1
      },
      {
        "id": "profile",
        "name": "Profile Setup",
        "description": "Complete your profile information",
        "status": "in_progress",
        "required": true,
        "order": 2
      },
      {
        "id": "verification",
        "name": "Identity Verification",
        "description": "Verify your identity",
        "status": "pending",
        "required": true,
        "order": 3
      },
      {
        "id": "preferences",
        "name": "Preferences",
        "description": "Set your preferences",
        "status": "pending",
        "required": false,
        "order": 4
      },
      {
        "id": "complete",
        "name": "Complete",
        "description": "Finish onboarding",
        "status": "pending",
        "required": true,
        "order": 5
      }
    ],
    "progress": {
      "completed_steps": 1,
      "total_steps": 5,
      "percentage": 20
    },
    "linked_at": "2024-01-01T12:30:00Z",
    "created_at": "2024-01-01T12:00:00Z",
    "updated_at": "2024-01-01T12:30:00Z"
  }
}
```

</ResponseExample>

## Error Responses

<ResponseExample>

```json Invalid Token
{
  "success": false,
  "message": "Invalid onboarding token",
  "error": {
    "code": "INVALID_ONBOARDING_TOKEN",
    "type": "validation_error",
    "details": "The provided onboarding token is invalid or expired"
  }
}
```

```json Already Linked
{
  "success": false,
  "message": "Onboarding session already linked",
  "error": {
    "code": "ONBOARDING_ALREADY_LINKED",
    "type": "validation_error",
    "details": "This onboarding session is already linked to a user"
  }
}
```

```json Unauthorized
{
  "success": false,
  "message": "Unauthorized",
  "error": {
    "code": "UNAUTHORIZED",
    "type": "authentication_error",
    "details": "Invalid or expired token"
  }
}
```

</ResponseExample>

## Status Codes

<ResponseField name="200" type="number">
  Onboarding session linked successfully
</ResponseField>

<ResponseField name="400" type="number">
  Bad request - validation errors
</ResponseField>

<ResponseField name="401" type="number">
  Unauthorized - invalid or expired token
</ResponseField>

<ResponseField name="404" type="number">
  Not found - onboarding session not found
</ResponseField>

<ResponseField name="409" type="number">
  Conflict - onboarding session already linked
</ResponseField>

<ResponseField name="500" type="number">
  Internal server error
</ResponseField>

## Use Cases

### Post-Registration Linking

<CodeGroup>

```javascript JavaScript
class OnboardingLinker {
  constructor(apiClient) {
    this.apiClient = apiClient;
  }
  
  async linkOnboardingSession(onboardingToken) {
    try {
      const response = await this.apiClient.post('/v1/onboard/link', {
        onboarding_token: onboardingToken,
        metadata: {
          source: 'web',
          referral_code: this.getReferralCode()
        }
      });
      
      if (response.success) {
        this.updateOnboardingSession(response.data);
        return response.data;
      } else {
        throw new Error(response.message);
      }
    } catch (error) {
      console.error('Failed to link onboarding session:', error);
      throw error;
    }
  }
  
  updateOnboardingSession(sessionData) {
    // Update stored session data
    localStorage.setItem('onboarding_session', JSON.stringify(sessionData));
    
    // Update UI to show linked status
    this.updateUIForLinkedSession(sessionData);
  }
  
  updateUIForLinkedSession(sessionData) {
    // Show linked status
    const statusElement = document.getElementById('onboarding-status');
    statusElement.textContent = 'Linked to your account';
    statusElement.className = 'status linked';
    
    // Update progress
    const progressElement = document.getElementById('onboarding-progress');
    progressElement.textContent = `${sessionData.progress.percentage}% complete`;
    
    // Show current step
    const currentStepElement = document.getElementById('current-step');
    currentStepElement.textContent = sessionData.current_step;
  }
  
  getReferralCode() {
    // Get referral code from URL parameters or localStorage
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('ref') || localStorage.getItem('referral_code');
  }
  
  async handlePostRegistrationLinking() {
    // Get onboarding token from localStorage
    const onboardingToken = localStorage.getItem('onboarding_token');
    
    if (onboardingToken) {
      try {
        const session = await this.linkOnboardingSession(onboardingToken);
        console.log('Onboarding session linked:', session);
        
        // Redirect to onboarding flow
        window.location.href = `/onboarding/${session.id}`;
      } catch (error) {
        console.error('Failed to link onboarding session:', error);
        // Continue with normal flow
      }
    }
  }
}

// Usage
const onboardingLinker = new OnboardingLinker(apiClient);

// Handle post-registration linking
document.addEventListener('DOMContentLoaded', async () => {
  await onboardingLinker.handlePostRegistrationLinking();
});
```

</CodeGroup>

### Cross-Device Linking

<CodeGroup>

```javascript JavaScript
class CrossDeviceOnboarding {
  constructor(apiClient) {
    this.apiClient = apiClient;
  }
  
  async linkOnboardingFromQRCode(qrCodeData) {
    try {
      const response = await this.apiClient.post('/v1/onboard/link', {
        onboarding_token: qrCodeData.token,
        metadata: {
          source: 'mobile',
          device_type: 'mobile'
        }
      });
      
      if (response.success) {
        return response.data;
      } else {
        throw new Error(response.message);
      }
    } catch (error) {
      console.error('Failed to link onboarding from QR code:', error);
      throw error;
    }
  }
  
  async generateOnboardingQRCode() {
    try {
      const response = await this.apiClient.get('/v1/onboard/qrcode');
      
      if (response.success) {
        return response.data;
      } else {
        throw new Error(response.message);
      }
    } catch (error) {
      console.error('Failed to generate onboarding QR code:', error);
      throw error;
    }
  }
  
  displayQRCode(qrCodeData) {
    const qrCodeElement = document.getElementById('onboarding-qr-code');
    qrCodeElement.src = qrCodeData.qr_code;
    qrCodeElement.alt = 'Onboarding QR Code';
    
    const instructionsElement = document.getElementById('qr-instructions');
    instructionsElement.innerHTML = `
      <h3>Scan with your mobile device</h3>
      <p>Use your mobile device to scan this QR code and continue onboarding on your phone.</p>
      <p>Token: <code>${qrCodeData.token}</code></p>
    `;
  }
}

// Usage
const crossDeviceOnboarding = new CrossDeviceOnboarding(apiClient);

// Generate QR code for cross-device linking
document.getElementById('generate-qr').addEventListener('click', async () => {
  try {
    const qrCodeData = await crossDeviceOnboarding.generateOnboardingQRCode();
    crossDeviceOnboarding.displayQRCode(qrCodeData);
  } catch (error) {
    console.error('Failed to generate QR code:', error);
  }
});
```

</CodeGroup>

## Implementation Example

<CodeGroup>

```javascript JavaScript
class OnboardingSessionManager {
  constructor(apiClient) {
    this.apiClient = apiClient;
  }
  
  async linkSession(onboardingToken, options = {}) {
    try {
      const response = await this.apiClient.post('/v1/onboard/link', {
        onboarding_token: onboardingToken,
        user_id: options.userId,
        metadata: options.metadata || {}
      });
      
      if (response.success) {
        this.storeLinkedSession(response.data);
        return response.data;
      } else {
        throw new Error(response.message);
      }
    } catch (error) {
      console.error('Failed to link onboarding session:', error);
      throw error;
    }
  }
  
  storeLinkedSession(sessionData) {
    // Store linked session data
    localStorage.setItem('linked_onboarding_session', JSON.stringify(sessionData));
    
    // Update session status
    const statusElement = document.getElementById('session-status');
    statusElement.textContent = 'Linked to your account';
    statusElement.className = 'status linked';
  }
  
  getLinkedSession() {
    const sessionData = localStorage.getItem('linked_onboarding_session');
    return sessionData ? JSON.parse(sessionData) : null;
  }
  
  clearLinkedSession() {
    localStorage.removeItem('linked_onboarding_session');
  }
  
  async handleOnboardingLinking() {
    // Check if there's an onboarding token in the URL
    const urlParams = new URLSearchParams(window.location.search);
    const onboardingToken = urlParams.get('onboarding_token');
    
    if (onboardingToken) {
      try {
        const session = await this.linkSession(onboardingToken, {
          metadata: {
            source: 'web',
            referral_code: urlParams.get('ref')
          }
        });
        
        console.log('Onboarding session linked:', session);
        
        // Redirect to onboarding flow
        window.location.href = `/onboarding/${session.id}`;
      } catch (error) {
        console.error('Failed to link onboarding session:', error);
        // Show error message to user
        this.showErrorMessage('Failed to link onboarding session. Please try again.');
      }
    }
  }
  
  showErrorMessage(message) {
    const errorElement = document.getElementById('error-message');
    errorElement.textContent = message;
    errorElement.style.display = 'block';
  }
}

// Usage
const sessionManager = new OnboardingSessionManager(apiClient);

// Handle onboarding linking on page load
document.addEventListener('DOMContentLoaded', async () => {
  await sessionManager.handleOnboardingLinking();
});
```

</CodeGroup>

## Related Endpoints

<CardGroup cols={2}>
  <Card
    title="Create Onboarding"
    icon="plus"
    href="/api/onboard/create"
  >
    Create a new onboarding session
  </Card>
  <Card
    title="Onboarding Guide"
    icon="book"
    href="/guides/onboarding"
  >
    Complete onboarding guide
  </Card>
  <Card
    title="Support"
    icon="headset"
    href="mailto:support@hashrails.xyz"
  >
    Get help with onboarding
  </Card>
</CardGroup>
