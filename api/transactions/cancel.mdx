---
title: "Cancel Transaction"
api: "POST /v1/transactions/{id}/cancel"
description: "Cancel a pending transaction"
---

## Overview

Cancel a pending transaction that has not yet been processed. This endpoint allows users to cancel transactions that are still awaiting payment confirmation or in the early stages of processing.

<Warning>
Once a transaction is cancelled, it cannot be reversed. Only pending transactions can be cancelled. Completed or failed transactions cannot be cancelled.
</Warning>

## Path Parameters

<ParamField path="id" type="string" required>
  The unique internal ID of the transaction to cancel
  
  **Format:** UUID (e.g., `123e4567-e89b-12d3-a456-426614174000`)
</ParamField>

## Request Body

<ParamField body="reason" type="string">
  Reason for cancelling the transaction
  
  **Format:** String describing why the transaction is being cancelled
  **Note:** Optional but recommended for audit purposes
</ParamField>

<ParamField body="metadata" type="object">
  Additional metadata for the cancellation
  
  **Format:** JSON object with custom fields
  **Note:** Optional field for storing cancellation context
</ParamField>

## Response

<ResponseField name="id" type="string">
  Unique internal identifier for the transaction
</ResponseField>

<ResponseField name="reference" type="string">
  Unique reference ID for the transaction
</ResponseField>

<ResponseField name="status" type="string">
  Updated transaction status (`cancelled`)
</ResponseField>

<ResponseField name="reason" type="string">
  Reason for cancellation
</ResponseField>

<ResponseField name="cancelled_at" type="string">
  Cancellation timestamp (ISO 8601)
</ResponseField>

<ResponseField name="updated_at" type="string">
  Last update timestamp (ISO 8601)
</ResponseField>

<ResponseField name="events" type="array">
  Updated array of transaction events including cancellation
</ResponseField>

<ResponseField name="events[].status" type="string">
  Event status
</ResponseField>

<ResponseField name="events[].timestamp" type="string">
  Event timestamp (ISO 8601)
</ResponseField>

<ResponseField name="events[].description" type="string">
  Event description
</ResponseField>

## Example Request

<CodeGroup>

```bash cURL
curl -X POST "https://api.railsfromthecrypt.com/v1/transactions/123e4567-e89b-12d3-a456-426614174000/cancel" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "reason": "User requested cancellation",
    "metadata": {
      "cancelled_by": "user",
      "cancellation_source": "mobile_app"
    }
  }'
```

```javascript JavaScript
const response = await fetch('https://api.railsfromthecrypt.com/v1/transactions/123e4567-e89b-12d3-a456-426614174000/cancel', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer YOUR_ACCESS_TOKEN',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    reason: 'User requested cancellation',
    metadata: {
      cancelled_by: 'user',
      cancellation_source: 'mobile_app'
    }
  })
});

const transaction = await response.json();
```

```python Python
import requests

response = requests.post(
    'https://api.railsfromthecrypt.com/v1/transactions/123e4567-e89b-12d3-a456-426614174000/cancel',
    headers={
        'Authorization': 'Bearer YOUR_ACCESS_TOKEN',
        'Content-Type': 'application/json'
    },
    json={
        'reason': 'User requested cancellation',
        'metadata': {
            'cancelled_by': 'user',
            'cancellation_source': 'mobile_app'
        }
    }
)
transaction = response.json()
```

```php PHP
<?php

$response = $httpClient->post('https://api.railsfromthecrypt.com/v1/transactions/123e4567-e89b-12d3-a456-426614174000/cancel', [
    'headers' => [
        'Authorization' => 'Bearer YOUR_ACCESS_TOKEN',
        'Content-Type' => 'application/json'
    ],
    'json' => [
        'reason' => 'User requested cancellation',
        'metadata' => [
            'cancelled_by' => 'user',
            'cancellation_source' => 'mobile_app'
        ]
    ]
]);
$transaction = $response->json();
```

</CodeGroup>

## Example Response

<ResponseExample>

```json Success Response
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "reference": "TXN-1234567890",
  "status": "cancelled",
  "reason": "User requested cancellation",
  "cancelled_at": "2024-01-01T12:30:00Z",
  "updated_at": "2024-01-01T12:30:00Z",
  "events": [
    {
      "status": "awaiting_payment",
      "timestamp": "2024-01-01T12:00:00Z",
      "description": "Awaiting payment confirmation"
    },
    {
      "status": "cancelled",
      "timestamp": "2024-01-01T12:30:00Z",
      "description": "Transaction cancelled by user"
    }
  ]
}
```

</ResponseExample>

## Error Responses

<ResponseField name="message" type="string">
  Error description
</ResponseField>

<ResponseField name="error" type="object">
  Error details
</ResponseField>

### Common Error Codes

<CardGroup cols={2}>
  <Card title="404 Not Found" icon="search">
    - **TRANSACTION_NOT_FOUND**: Transaction with the specified ID not found
    - **INVALID_ID**: Invalid transaction ID format
  </Card>
  <Card title="400 Bad Request" icon="exclamation-triangle">
    - **CANNOT_CANCEL**: Transaction cannot be cancelled in current status
    - **ALREADY_CANCELLED**: Transaction is already cancelled
    - **INVALID_STATUS**: Transaction is not in a cancellable state
  </Card>
  <Card title="401 Unauthorized" icon="shield-exclamation">
    - **INVALID_TOKEN**: Invalid or expired access token
    - **MISSING_TOKEN**: Authorization header missing
  </Card>
  <Card title="403 Forbidden" icon="lock">
    - **ACCESS_DENIED**: User doesn't have access to this transaction
    - **CANCELLATION_NOT_ALLOWED**: User not allowed to cancel this transaction
  </Card>
</CardGroup>

## Usage Examples

### Basic Transaction Cancellation

<CodeGroup>

```javascript JavaScript
async function cancelTransaction(transactionId, reason = null) {
  try {
    const response = await fetch(`https://api.railsfromthecrypt.com/v1/transactions/${transactionId}/cancel`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${accessToken}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        reason: reason
      })
    });

    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.message || 'Failed to cancel transaction');
    }

    const transaction = await response.json();
    console.log('Transaction cancelled:', transaction);
    
    return transaction;
  } catch (error) {
    console.error('Error cancelling transaction:', error);
    throw error;
  }
}

// Usage
await cancelTransaction('123e4567-e89b-12d3-a456-426614174000', 'User requested cancellation');
```

```python Python
def cancel_transaction(transaction_id, reason=None):
    try:
        response = requests.post(
            f'https://api.railsfromthecrypt.com/v1/transactions/{transaction_id}/cancel',
            headers={
                'Authorization': f'Bearer {access_token}',
                'Content-Type': 'application/json'
            },
            json={'reason': reason}
        )
        
        if not response.ok:
            error = response.json()
            raise Exception(error.get('message', 'Failed to cancel transaction'))
        
        transaction = response.json()
        print('Transaction cancelled:', transaction)
        
        return transaction
        
    except Exception as e:
        print(f'Error cancelling transaction: {e}')
        raise

# Usage
cancel_transaction('123e4567-e89b-12d3-a456-426614174000', 'User requested cancellation')
```

</CodeGroup>

### Cancellation with Metadata

<CodeGroup>

```javascript JavaScript
async function cancelTransactionWithMetadata(transactionId, reason, metadata) {
  try {
    const response = await fetch(`https://api.railsfromthecrypt.com/v1/transactions/${transactionId}/cancel`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${accessToken}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        reason: reason,
        metadata: metadata
      })
    });

    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.message || 'Failed to cancel transaction');
    }

    const transaction = await response.json();
    console.log('Transaction cancelled with metadata:', transaction);
    
    return transaction;
  } catch (error) {
    console.error('Error cancelling transaction with metadata:', error);
    throw error;
  }
}

// Usage
const metadata = {
  cancelled_by: 'user',
  cancellation_source: 'mobile_app',
  user_agent: 'Mozilla/5.0...',
  ip_address: '192.168.1.100'
};

await cancelTransactionWithMetadata(
  '123e4567-e89b-12d3-a456-426614174000',
  'User requested cancellation',
  metadata
);
```

</CodeGroup>

### Check if Transaction Can Be Cancelled

<CodeGroup>

```javascript JavaScript
async function canCancelTransaction(transactionId) {
  try {
    // First, get the transaction to check its status
    const response = await fetch(`https://api.railsfromthecrypt.com/v1/transactions/${transactionId}`, {
      headers: {
        'Authorization': `Bearer ${accessToken}`
      }
    });

    if (!response.ok) {
      throw new Error('Failed to fetch transaction');
    }

    const transaction = await response.json();
    
    // Check if transaction can be cancelled
    const cancellableStatuses = ['pending', 'awaiting_payment'];
    const canCancel = cancellableStatuses.includes(transaction.status);
    
    return {
      canCancel,
      status: transaction.status,
      reason: canCancel ? null : `Transaction is in ${transaction.status} status and cannot be cancelled`
    };
  } catch (error) {
    console.error('Error checking if transaction can be cancelled:', error);
    throw error;
  }
}

// Usage
const cancellationCheck = await canCancelTransaction('123e4567-e89b-12d3-a456-426614174000');
if (cancellationCheck.canCancel) {
  await cancelTransaction('123e4567-e89b-12d3-a456-426614174000', 'User requested cancellation');
} else {
  console.log('Cannot cancel transaction:', cancellationCheck.reason);
}
```

</CodeGroup>

### Batch Transaction Cancellation

<CodeGroup>

```javascript JavaScript
async function cancelMultipleTransactions(transactionIds, reason) {
  try {
    const promises = transactionIds.map(id => 
      cancelTransaction(id, reason).catch(error => ({
        id,
        error: error.message,
        success: false
      }))
    );
    
    const results = await Promise.allSettled(promises);
    
    const successful = [];
    const failed = [];
    
    results.forEach((result, index) => {
      if (result.status === 'fulfilled') {
        if (result.value.success === false) {
          failed.push(result.value);
        } else {
          successful.push(result.value);
        }
      } else {
        failed.push({
          id: transactionIds[index],
          error: result.reason.message,
          success: false
        });
      }
    });
    
    return {
      successful,
      failed,
      total: transactionIds.length,
      successCount: successful.length,
      failureCount: failed.length
    };
  } catch (error) {
    console.error('Error cancelling multiple transactions:', error);
    throw error;
  }
}

// Usage
const transactionIds = [
  '123e4567-e89b-12d3-a456-426614174000',
  '123e4567-e89b-12d3-a456-426614174001',
  '123e4567-e89b-12d3-a456-426614174002'
];

const results = await cancelMultipleTransactions(transactionIds, 'Batch cancellation');
console.log(`Successfully cancelled ${results.successCount} out of ${results.total} transactions`);
```

</CodeGroup>

### Transaction Cancellation with Confirmation

<CodeGroup>

```javascript JavaScript
class TransactionCanceller {
  constructor(apiClient) {
    this.apiClient = apiClient;
  }
  
  async cancelTransactionWithConfirmation(transactionId, reason, requireConfirmation = true) {
    try {
      // Check if transaction can be cancelled
      const canCancel = await this.canCancelTransaction(transactionId);
      
      if (!canCancel.canCancel) {
        throw new Error(canCancel.reason);
      }
      
      // If confirmation is required, show confirmation dialog
      if (requireConfirmation) {
        const confirmed = await this.showCancellationConfirmation(transactionId, reason);
        if (!confirmed) {
          throw new Error('Cancellation cancelled by user');
        }
      }
      
      // Cancel the transaction
      const cancelledTransaction = await this.cancelTransaction(transactionId, reason);
      
      // Notify user of successful cancellation
      this.notifyCancellationSuccess(cancelledTransaction);
      
      return cancelledTransaction;
    } catch (error) {
      console.error('Error cancelling transaction with confirmation:', error);
      this.notifyCancellationError(error);
      throw error;
    }
  }
  
  async canCancelTransaction(transactionId) {
    const response = await fetch(`https://api.railsfromthecrypt.com/v1/transactions/${transactionId}`, {
      headers: {
        'Authorization': `Bearer ${accessToken}`
      }
    });
    
    if (!response.ok) {
      throw new Error('Failed to fetch transaction');
    }
    
    const transaction = await response.json();
    const cancellableStatuses = ['pending', 'awaiting_payment'];
    
    return {
      canCancel: cancellableStatuses.includes(transaction.status),
      status: transaction.status,
      reason: cancellableStatuses.includes(transaction.status) ? null : `Transaction is in ${transaction.status} status and cannot be cancelled`
    };
  }
  
  async showCancellationConfirmation(transactionId, reason) {
    // This would typically show a UI confirmation dialog
    // For this example, we'll simulate it
    return confirm(`Are you sure you want to cancel transaction ${transactionId}? Reason: ${reason}`);
  }
  
  async cancelTransaction(transactionId, reason) {
    const response = await fetch(`https://api.railsfromthecrypt.com/v1/transactions/${transactionId}/cancel`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${accessToken}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ reason })
    });
    
    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.message || 'Failed to cancel transaction');
    }
    
    return await response.json();
  }
  
  notifyCancellationSuccess(transaction) {
    console.log(`Transaction ${transaction.reference} has been cancelled successfully`);
    // Show success notification to user
  }
  
  notifyCancellationError(error) {
    console.error('Failed to cancel transaction:', error.message);
    // Show error notification to user
  }
}

// Usage
const canceller = new TransactionCanceller();
await canceller.cancelTransactionWithConfirmation(
  '123e4567-e89b-12d3-a456-426614174000',
  'User requested cancellation',
  true
);
```

</CodeGroup>

## Best Practices

<AccordionGroup>
  <Accordion title="Cancellation Rules">
    - Only allow cancellation of pending transactions
    - Implement proper status validation before cancellation
    - Require confirmation for cancellation actions
    - Log all cancellation attempts for audit purposes
  </Accordion>
  <Accordion title="User Experience">
    - Show clear cancellation confirmation dialogs
    - Provide clear feedback on cancellation results
    - Allow users to see why cancellation might not be possible
    - Implement proper error handling and messaging
  </Accordion>
  <Accordion title="Error Handling">
    - Handle validation errors gracefully
    - Provide clear error messages to users
    - Implement proper logging for debugging
    - Use appropriate HTTP status codes
  </Accordion>
  <Accordion title="Security">
    - Validate user permissions before cancellation
    - Log all cancellation attempts for audit purposes
    - Use secure communication (HTTPS)
    - Implement rate limiting for cancellation requests
  </Accordion>
</AccordionGroup>

## Related Endpoints

<CardGroup cols={2}>
  <Card
    title="Get Transaction by ID"
    icon="id-card"
    href="/api/transactions/get-by-id"
  >
    Get a specific transaction by internal ID
  </Card>
  <Card
    title="Update Transaction"
    icon="edit"
    href="/api/transactions/update"
  >
    Update transaction details or status
  </Card>
  <Card
    title="Retry Transaction"
    icon="redo"
    href="/api/transactions/retry"
  >
    Retry a failed transaction
  </Card>
  <Card
    title="List Transactions"
    icon="list"
    href="/api/transactions/list"
  >
    Get paginated list of all transactions
  </Card>
</CardGroup>
