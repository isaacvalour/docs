---
title: "Process Virtual Account Request"
api: "POST /v1/virtual-accounts/requests/{id}/process"
description: "Process a virtual account request"
---

## Overview

Process a virtual account request to create the actual virtual account. This endpoint is used to approve and process pending virtual account requests.

<Note>
  This endpoint requires authentication via Bearer token in the Authorization header.
</Note>

## Request

<ParamField header="Authorization" type="string" required>
  Bearer token for authentication. Format: `Bearer <access_token>`
</ParamField>

<ParamField path="id" type="string" required>
  Virtual account request ID to process.
</ParamField>

<ParamField body="action" type="string" required>
  Action to perform. Possible values: "approve", "reject".
</ParamField>

<ParamField body="notes" type="string">
  Optional notes for the processing action.
</ParamField>

<ParamField body="metadata" type="object">
  Additional metadata for the processing action.
</ParamField>

<ParamField body="metadata.reason" type="string">
  Reason for approval or rejection.
</ParamField>

<ParamField body="metadata.reviewer" type="string">
  Name of the reviewer processing the request.
</ParamField>

## Response

<ResponseField name="success" type="boolean">
  Indicates if the request was processed successfully.
</ResponseField>

<ResponseField name="message" type="string">
  Success message.
</ResponseField>

<ResponseField name="data" type="object">
  Processed request data.
</ResponseField>

<ResponseField name="data.id" type="string">
  Virtual account request ID.
</ResponseField>

<ResponseField name="data.currency" type="string">
  Virtual account currency.
</ResponseField>

<ResponseField name="data.status" type="string">
  Updated request status.
</ResponseField>

<ResponseField name="data.action" type="string">
  Action that was performed.
</ResponseField>

<ResponseField name="data.processed_at" type="string">
  Timestamp when the request was processed.
</ResponseField>

<ResponseField name="data.processed_by" type="string">
  User who processed the request.
</ResponseField>

<ResponseField name="data.notes" type="string">
  Notes from the processing action.
</ResponseField>

<ResponseField name="data.virtualAccount" type="object">
  Virtual account details (if approved).
</ResponseField>

<ResponseField name="data.virtualAccount.id" type="string">
  Virtual account ID.
</ResponseField>

<ResponseField name="data.virtualAccount.account_number" type="string">
  Virtual account number.
</ResponseField>

<ResponseField name="data.virtualAccount.account_name" type="string">
  Virtual account name.
</ResponseField>

<ResponseField name="data.virtualAccount.bank_name" type="string">
  Bank name.
</ResponseField>

<ResponseField name="data.virtualAccount.routing_number" type="string">
  Bank routing number (USD accounts only).
</ResponseField>

<ResponseField name="data.virtualAccount.reference" type="string">
  Unique reference for tracking payments.
</ResponseField>

<ResponseField name="data.virtualAccount.provider" type="string">
  Payment provider.
</ResponseField>

<ResponseField name="data.virtualAccount.network" type="string">
  Blockchain network.
</ResponseField>

<ResponseField name="data.virtualAccount.wallet_address" type="string">
  Settlement wallet address.
</ResponseField>

<ResponseField name="data.created_at" type="string">
  Request creation timestamp.
</ResponseField>

<ResponseField name="data.updated_at" type="string">
  Request last update timestamp.
</ResponseField>

## Example Request

<CodeGroup>

```bash cURL
curl -X POST "https://api.railsfromthecrypt.com/v1/virtual-accounts/requests/req_1234567890/process" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "action": "approve",
    "notes": "All documents verified and approved",
    "metadata": {
      "reason": "Complete documentation provided",
      "reviewer": "John Doe"
    }
  }'
```

```javascript JavaScript
const response = await fetch('https://api.railsfromthecrypt.com/v1/virtual-accounts/requests/req_1234567890/process', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer YOUR_ACCESS_TOKEN',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    action: 'approve',
    notes: 'All documents verified and approved',
    metadata: {
      reason: 'Complete documentation provided',
      reviewer: 'John Doe'
    }
  })
});

const data = await response.json();
console.log(data);
```

```python Python
import requests

response = requests.post(
    'https://api.railsfromthecrypt.com/v1/virtual-accounts/requests/req_1234567890/process',
    headers={
        'Authorization': 'Bearer YOUR_ACCESS_TOKEN',
        'Content-Type': 'application/json'
    },
    json={
        'action': 'approve',
        'notes': 'All documents verified and approved',
        'metadata': {
            'reason': 'Complete documentation provided',
            'reviewer': 'John Doe'
        }
    }
)

data = response.json()
print(data)
```

</CodeGroup>

## Example Response

<ResponseExample>

```json Approval Response
{
  "success": true,
  "message": "Virtual account request processed successfully",
  "data": {
    "id": "req_1234567890",
    "currency": "USD",
    "status": "approved",
    "action": "approve",
    "processed_at": "2024-01-01T12:00:00Z",
    "processed_by": "user_1234567890",
    "notes": "All documents verified and approved",
    "virtualAccount": {
      "id": "va_1234567890",
      "account_number": "1234567890",
      "account_name": "HashRails Virtual Account",
      "bank_name": "Bridge Bank",
      "routing_number": "021000021",
      "reference": "HR_VA_1234567890",
      "provider": "Bridge",
      "network": "Polygon",
      "wallet_address": "0x1234567890abcdef1234567890abcdef12345678"
    },
    "created_at": "2024-01-01T11:30:00Z",
    "updated_at": "2024-01-01T12:00:00Z"
  }
}
```

```json Rejection Response
{
  "success": true,
  "message": "Virtual account request processed successfully",
  "data": {
    "id": "req_1234567890",
    "currency": "USD",
    "status": "rejected",
    "action": "reject",
    "processed_at": "2024-01-01T12:00:00Z",
    "processed_by": "user_1234567890",
    "notes": "Incomplete documentation provided",
    "virtualAccount": null,
    "created_at": "2024-01-01T11:30:00Z",
    "updated_at": "2024-01-01T12:00:00Z"
  }
}
```

</ResponseExample>

## Error Responses

<ResponseExample>

```json Request Not Found
{
  "success": false,
  "message": "Virtual account request not found",
  "error": {
    "code": "REQUEST_NOT_FOUND",
    "type": "not_found_error",
    "details": "The specified virtual account request does not exist"
  }
}
```

```json Invalid Action
{
  "success": false,
  "message": "Invalid action",
  "error": {
    "code": "INVALID_ACTION",
    "type": "validation_error",
    "details": "Action must be either 'approve' or 'reject'"
  }
}
```

```json Request Already Processed
{
  "success": false,
  "message": "Request already processed",
  "error": {
    "code": "REQUEST_ALREADY_PROCESSED",
    "type": "validation_error",
    "details": "This virtual account request has already been processed"
  }
}
```

```json Unauthorized
{
  "success": false,
  "message": "Unauthorized",
  "error": {
    "code": "UNAUTHORIZED",
    "type": "authentication_error",
    "details": "Invalid or expired token"
  }
}
```

</ResponseExample>

## Status Codes

<ResponseField name="200" type="number">
  Request processed successfully
</ResponseField>

<ResponseField name="400" type="number">
  Bad request - validation errors
</ResponseField>

<ResponseField name="401" type="number">
  Unauthorized - invalid or expired token
</ResponseField>

<ResponseField name="404" type="number">
  Not found - request not found
</ResponseField>

<ResponseField name="409" type="number">
  Conflict - request already processed
</ResponseField>

<ResponseField name="500" type="number">
  Internal server error
</ResponseField>

## Processing Actions

### Approve Request

When approving a virtual account request:

- **Status**: Changes to "approved"
- **Virtual Account**: Created with provider
- **Account Details**: Generated and returned
- **Settlement**: Wallet address assigned
- **Notifications**: Sent to client

### Reject Request

When rejecting a virtual account request:

- **Status**: Changes to "rejected"
- **Virtual Account**: Not created
- **Reason**: Stored for reference
- **Notifications**: Sent to client with rejection reason

## Implementation Example

<CodeGroup>

```javascript JavaScript
class VirtualAccountProcessor {
  constructor(apiClient) {
    this.apiClient = apiClient;
  }
  
  async processRequest(requestId, action, options = {}) {
    try {
      const response = await this.apiClient.post(`/v1/virtual-accounts/requests/${requestId}/process`, {
        action: action,
        notes: options.notes,
        metadata: options.metadata
      });
      
      if (response.success) {
        this.handleProcessedRequest(response.data);
        return response.data;
      } else {
        throw new Error(response.message);
      }
    } catch (error) {
      console.error('Failed to process request:', error);
      throw error;
    }
  }
  
  async approveRequest(requestId, notes, metadata = {}) {
    return this.processRequest(requestId, 'approve', {
      notes: notes,
      metadata: {
        reason: 'Approved after review',
        reviewer: this.getCurrentUser(),
        ...metadata
      }
    });
  }
  
  async rejectRequest(requestId, reason, notes, metadata = {}) {
    return this.processRequest(requestId, 'reject', {
      notes: notes,
      metadata: {
        reason: reason,
        reviewer: this.getCurrentUser(),
        ...metadata
      }
    });
  }
  
  handleProcessedRequest(requestData) {
    if (requestData.action === 'approve') {
      this.handleApprovedRequest(requestData);
    } else if (requestData.action === 'reject') {
      this.handleRejectedRequest(requestData);
    }
  }
  
  handleApprovedRequest(requestData) {
    console.log('Request approved:', requestData);
    
    // Show success message
    this.showSuccessMessage('Virtual account request approved successfully');
    
    // Display virtual account details
    this.displayVirtualAccountDetails(requestData.virtualAccount);
    
    // Send notification to client
    this.sendApprovalNotification(requestData);
  }
  
  handleRejectedRequest(requestData) {
    console.log('Request rejected:', requestData);
    
    // Show rejection message
    this.showRejectionMessage('Virtual account request rejected');
    
    // Send notification to client
    this.sendRejectionNotification(requestData);
  }
  
  displayVirtualAccountDetails(virtualAccount) {
    const container = document.getElementById('virtual-account-details');
    
    container.innerHTML = `
      <div class="virtual-account-card approved">
        <h3>Virtual Account Created</h3>
        <div class="account-details">
          <div class="detail-row">
            <label>Account Number:</label>
            <span class="account-number">${virtualAccount.account_number}</span>
          </div>
          <div class="detail-row">
            <label>Account Name:</label>
            <span>${virtualAccount.account_name}</span>
          </div>
          <div class="detail-row">
            <label>Bank Name:</label>
            <span>${virtualAccount.bank_name}</span>
          </div>
          ${virtualAccount.routing_number ? `
            <div class="detail-row">
              <label>Routing Number:</label>
              <span>${virtualAccount.routing_number}</span>
            </div>
          ` : ''}
          <div class="detail-row">
            <label>Reference:</label>
            <span class="reference">${virtualAccount.reference}</span>
          </div>
          <div class="detail-row">
            <label>Provider:</label>
            <span>${virtualAccount.provider}</span>
          </div>
        </div>
      </div>
    `;
  }
  
  sendApprovalNotification(requestData) {
    // Send email notification to client
    const notificationData = {
      type: 'virtual_account_approved',
      client_id: requestData.client_id,
      virtual_account: requestData.virtualAccount,
      message: 'Your virtual account has been approved and is ready to use.'
    };
    
    // This would typically call a notification service
    console.log('Sending approval notification:', notificationData);
  }
  
  sendRejectionNotification(requestData) {
    // Send email notification to client
    const notificationData = {
      type: 'virtual_account_rejected',
      client_id: requestData.client_id,
      reason: requestData.metadata?.reason,
      notes: requestData.notes,
      message: 'Your virtual account request has been rejected.'
    };
    
    // This would typically call a notification service
    console.log('Sending rejection notification:', notificationData);
  }
  
  getCurrentUser() {
    // Get current user from authentication context
    return 'current_user_id';
  }
  
  showSuccessMessage(message) {
    const toast = document.createElement('div');
    toast.className = 'toast success';
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
      toast.remove();
    }, 3000);
  }
  
  showRejectionMessage(message) {
    const toast = document.createElement('div');
    toast.className = 'toast error';
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
      toast.remove();
    }, 3000);
  }
}

// Usage
const processor = new VirtualAccountProcessor(apiClient);

// Approve request
document.getElementById('approve-request').addEventListener('click', async () => {
  const requestId = 'req_1234567890';
  const notes = 'All documents verified and approved';
  
  try {
    const result = await processor.approveRequest(requestId, notes);
    console.log('Request approved:', result);
  } catch (error) {
    console.error('Failed to approve request:', error);
  }
});

// Reject request
document.getElementById('reject-request').addEventListener('click', async () => {
  const requestId = 'req_1234567890';
  const reason = 'Incomplete documentation';
  const notes = 'Please provide complete business documentation';
  
  try {
    const result = await processor.rejectRequest(requestId, reason, notes);
    console.log('Request rejected:', result);
  } catch (error) {
    console.error('Failed to reject request:', error);
  }
});
```

</CodeGroup>

## Related Endpoints

<CardGroup cols={2}>
  <Card
    title="Create Virtual Account Request"
    icon="plus"
    href="/api/virtual-accounts/requests"
  >
    Create a new virtual account request
  </Card>
  <Card
    title="List Virtual Account Requests"
    icon="list"
    href="/api/virtual-accounts/requests"
  >
    List all virtual account requests
  </Card>
  <Card
    title="Get Virtual Account"
    icon="eye"
    href="/api/virtual-accounts/request/account"
  >
    Get virtual account details
  </Card>
  <Card
    title="Virtual Accounts Guide"
    icon="book"
    href="/guides/virtual-accounts"
  >
    Complete virtual accounts guide
  </Card>
</CardGroup>
